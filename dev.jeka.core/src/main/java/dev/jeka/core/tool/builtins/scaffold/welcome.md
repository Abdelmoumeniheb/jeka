# Welcome to Jeka

### Jeka directory content 

This directory contains everything Jeka needs to automate or build this project.

In this directory, you may find :
  * __def__ (directory - optional) : This is where lie your Java and/or Kotlin sources that will be executed by the automation engine.
  * __output__ (directory - generated) : Files produced by the build (jar, classes, reports, ...) are supposed to be generated here.
  * __boot__ (directory - optional) : All jars located here are added to the build classpath and can therefore be used by the classes defined in *def*.
  * __wrapper__ (directory - optional) : Contains the wrapper jar file for bootstrapping Jeka along its configuration.
  * __.work__ (directory - generated): temp files generated by Jeka internal engine are located here. Sources from _def_ are compiled here.
  * __options.properties__ (file - optional) : May contains configuration default defined at project level.
  * __cmd.properties__ (file - optional) : May contains predefined command shortcuts that can be invoked with a single keyword.

Depending on your needs, feel free to store any build related elements in this directory.

Besides, project root may also contain _jekaw_ and _jekaw.bat_ shell scripts to invoke jeka wrapper conveniently.

For the following, when we refer to the command `jeka`, you can use `./jekaw` indifferently.

### Write a simple build class and invoke it

Prior to writing a build class, you must import your project in your IDE with proper dependencies declared on.
* Execute `jeka intellij#iml` or `jeka eclipse#files` in order to generate metadata. 
* Attach the project to your Ide

Now you can create some Java or Kotlin classes in the _def_ directory.
* Create a class extending `JkClass`.
* Create a public method inside returning `void` and taking no parameters. Implementing with whatever you want (It can be a simple _hello world or complex release pipeline).
* Execute `jeka yourMethodName` on console at root of you project. It runs !
* Annotate it with `@JkDoc` mentioning the purpose of this method.
* Execute `jeka help`. It is now mentioned on help output.
* You can invoke several methods in a single command.
* You can have many classes extending _JkClass_ in your _def_ directory. In this case, you must specify witch class you want to run adding option `-JKC=[YourClassName]` to command line.
* If you want a class in _def_ not to be compiled, name it with a leading '_'.

#### Adding some parameters

* In your build class, declare a public field of a simple type (String, boolean, int, float, enum, date, composite objects of simple types).
* You can declare this field with a default value (e.g. `public int yourFieldName = 3;`).
* Make your methods use this field.
* Execute `jeka yourMethodName -yourFiedName=5`. The value is cast in declared type.
* Annotate this field with `@JkDoc` mentioning its purpose.
* Execute `jeka help`. It is now mentioned on help output.
* Create another public field, and annotate id with `@JkEnv` mentioning the name of an environment variable. 
* You can now use this environment variable cast to the desired type in your build classes (of course, you can also document it using `@JkDoc`).
* For more details about accepted types, see `dev.jeka.core.tool.FieldInjector#parse` method.
* For example about composite objects, see example in `dev.jeka.core.tool.builtins.java.JkPluginJava#pack` field.

#### Using 3rd party dependencies in build classes

Jeka embeds a bunch of utilities to perform build related tasks (file/zip manipulation, git, launching processes, compilation, testing, dependency management, crypto, ...) 
nevertheless, you may want rightfully to use some 3rd-party dependencies.

* One way is to add directly jar files to _jeka/boot_ directory.
  * Add jar files to _jeka/boot_ directory.
  * Execute `jeka intellij#iml` or `jeka eclipse#files`.
  * Now, you can use added libraries in your code.
* The other way is to annotate your build class with `@JkDefClasspath` mentioning either a module coordinate (e.g. _org.seleniumhq.selenium:selenium-remote-driver:4.0.0_) or a path on the local file system.
  * Annotate your build class as mentioned.
  * Execute `jeka intellij#iml` or `jeka eclipse#files`.
  * Now, you can use declared libraries along their dependencies in your code.
  * Be aware that a dependencies imported via `@JkDefClasspath` annotation is imported for all build classes and not only for annotated class.

#### Importing build classes from other projects

In multi-module projects, it's quite common that a build class access to a build instance coming from another module. 
You can achieve it in a statically typed way.

* In your build class, declare a field of type `JkClass` (e.g. Â´JkClass importedBuild;`). It doesn't have to be public.
* Annotate it with `@JkDefImport` mentioning the relative path of the imported project (e.g. `@JkDefImport("../anotherModule")).
* Execute `jeka intellij#iml` or `jeka eclipse#files`.
* Refine the declared type from `JkClass` to the concrete type of imported build class (the imported build class should extends `JkClass`).
* Now, you can access the imported build class in a static typed way.
* The imported build classes can also be accessed globally using `JkClass#getImportedJkClass` method. See example [here](https://github.com/jerkar/jeka/blob/master/dev.jeka.master/jeka/def/MasterBuild.java).
* Be careful that the imported build class deals with file paths using `JkClass#getBaseDir` method in order it can be safely executed from any working directory.


### Useful commands 

* `jeka help` : Displays on console methods and options invokable from command line, along plugins available in the classpath.
* `jeka [pugin-name]#help` : Displays on consoles all methods and option invokable for the specified plugin (e.g. `jeka scaffold#help`).
* `jeka intellij#iml` : Generates iml file for Intellij. It is generated according the dependencies declared for this project.
* `jeka intellij#iml -JKC=` : If the above fails cause your def classes do not compile, using `-JKC=` avoids def compilation phase.
* `jeka eclipse#files` : Same purpose as above to generate metadata files for Eclipse.
* `jeka scaffold#run` : Generates files for creating a basic Jeka project from scratch.
* `jeka scaffold#wrap` : Generates wrapper files (jekaw/jekaw.bat and bootstrap jar)
* `jeka scaffold#run java#` : Generate files for creating a Jeka project for building a JVM language project

### Useful standard options

You can add these options to you command line.

* `-JKC=[ClassName]` : By default, Jeka instantiates the first class found under _def_ directory to execute methods on. 
  You can force to instantiate a specific class by passing its long or short name. 
  If the class is already in classpath, then no _def_ compilation occurs.
  Using simply `-JKC=` is equivalent to `-JKC=JkClass` which is the base class bundled in Jeka.
* `-LRI` : Displays runtime info. This will display on console meaningfull information about current Jeka version, Java version, base directory, download repository, classpath, ...
* `-LSU` : Shows logs about jeka setup (compilation of def classes, plugin loading, ...).These informations are not logged by default.
* `-LS=BRACE` : Alters console output by delimiting tasks with braces and mentioning the processing time for each.
* `-LS=DEBUG` : Alters console output by showing the class name and line number from where the log has been emitted.
* `-LV` : Alters console output by displaying trace logs (emitted by `JkLog#trace`)
* `-FC` : Force compilation of _def_ classes, even if they are marked as up-to-date.

### How to change the JDK that will run _Jeka_

To determine the JDK to run upon, _jeka_ looks in priority order at :
* _JEKA_JDK_ environment variable ([_JEKA_JDK_]/bin/java must point on _java_ executable)
* _JAVA_HOME_ environment variable 

If none of these variables are present, _jeka_ will run upon the _java_ executable accessible from your _PATH_ environment.

### How to change the repository _Jeka_ uses to fetch dependencies 

By default, _jeka_ fetch dependencies from maven central (https://repo.maven.apache.org/maven2).

You can select another default repository by setting the `jeka.repos.download.url` options. 
We recommend storing this value in your [URSER DIR]/.jeka/options.properties file to be reused across projects.

For more details, see `JkRepoFromOptions` javadoc.

### How to pass options

