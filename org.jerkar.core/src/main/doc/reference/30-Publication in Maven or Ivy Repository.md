## Publication on binary repositories
----

Jerkar is able to publish on both Maven and Ivy repository. This includes repositories as [Sonatype Nexus](http://www.sonatype.org/nexus/) or [Jfrog Artifactory](http://www.jfrog.com/artifactory/).

Maven and Ivy have different publication model, so Jerkar proposes specific APIs according you want to publish on a Maven or Ivy repository. 

### Publish to a Maven repository

Jerkar proposes a complete API to pubish on Maven repository. The POM file will be generated by Jerkar according 
elements provider by the user.

#### Using raw API

You can set minimal information in order to deploy a file on a Maven repository as below :

```
File fileToPublish = new File("build/output/myFile.jar");
JkPublishRepo repo = JkRepo.maven("http://my.mvn.repo/publisher").asPublishRepo()
JkVersionedModule versionedModule = JkVersionedModule.of("myGroup:myName", "0.2.1");
JkPublisher.of(repo).publishMaven(versionedModule, JkMavenPublication.of(fileToPublish), JkDependencies.on());
```


You can also set additionnal informaton in order to :

- Publish more than one artifact.
- Produce & publish checksum files for each published artifact.
- Mention if you wish or not to use unique snapshot ([What is it ?](http://stackoverflow.com/questions/1243574/how-to-stop-maven-artifactory-from-keeping-snapshots-with-timestamps)).
- Feed generated pom with data necessary to publish on pubic repo ([see here](https://maven.apache.org/guides/mini/guide-central-repository-upload.html)).

```
// You can sign your artifatcs with PGP
JkPgp pgp = JkPgp.ofSecretRing(new File("/usr/myName/pgp/privateRing"), "myPgpPhrase");

JkPublishRepo repo = JkRepo.maven(publishRepo)
JkPublishRepo repo = JkRepo.maven(publishRepo)
    .withCredential("myRepoUserName", "myRepoPassword").asPublishRepo()
    .withUniqueSnapshot(false)
    .withSigner(pgp)
    .andSha1Md5Checksums(); // You can checksum each of published artifacts
			
JkVersionedModule versionedModule = JkVersionedModule.of("myGroup:myName", "0.2.1");
		
// Optinal : if you need to add metadata in the generated pom
JkMavenPublicationInfo info = JkMavenPublicationInfo
    .of("my project", "my description", "http://myproject.github")
    .withScm("http://scm/url/connection")
    .andApache2License()
    .andGitHubDeveloper("myName", "myName@provider.com");				
		
// Optional : if you want publish sources
File srcZip = ouputDir("src.zip");
JkZipper.of(this.src).to(srcZip);
		
JkMavenPublication publication = JkMavenPublication.of(jarFile).with(info).and(srcZip, "sources");
JkPublisher.of(repo).publishMaven(versionedModule, publication, JkDependencies.on());
```

#### Using JkJavaBuild template

When using this template, the effort you must produce to publish artifacts is minimal or zero if you don't need special feature.
The prerequisite is to setup your options.properties according to you infrastructure.

##### Using defaults

If you don't specify anything the publication will occurs locally at : _[JERKAR USER HOME]/maven-publish-dir_

If you specify only credential as

```
repo.publish.username=myUsername
repo.publish.password=myPassword
```

Jerkar will use OSSRH public repository : https://oss.sonatype.org/content/repositories/snapshots for snapshots 
and https://oss.sonatype.org/content/repositories/releases for releases. 
For more precision about default see [`JkDependencySupport#publishRepositories`](https://github.com/jerkar/jerkar/blob/master/org.jerkar.core/src/main/java/org/jerkar/tool/JkBuildDependencySupport.java) method.


##### Using explicit settings

You can set explicit settings at [JERKAR USER DIR]/options.properties level, so every build will leverage from these settings

```
repo.publish.url=https://my.nexus/snaphots
repo.publish.username=myNexusSnapshotUserName
repo.publish.password=myNexusSnapshotPassword
repo.release.url=https://my.nexus/releases
repo.release.username=myNexusReleaseUserName
repo.release.password=myNexusReleasePassword
```
In this case the snapshot artifacts (those with version's ending with '-SNAPSHOT') will be published on https://my.nexus/snaphots repository while the other will be published in https://my.nexus/releases.

If you mention only 

```
repo.publish.url=https://my.nexus/all
repo.publish.username=myNexusSnapshotUserName
repo.publish.password=myNexusSnapshotPassword
```
then everything will be published to https://my.nexus/all.

You can also override `publishRepositories``in your build script so you can write your own specific logic to setup and select publish repositories. 

```
@Override  
protected JkPublishRepos publishRepositories() {
    return JkPublishRepos.ossrh(JkOptions.get("ossrh.username"),
	    JkOptions.get("ossrh.password"), pgp());
}
```

